<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dq.aquaranth.company.mapper.CompanyMapper">

    <!--회사코드, 회사명, 대표자명, 사용여부 리스트 출력-->
    <select id="findAll" resultType="com.dq.aquaranth.company.dto.CompanyListDTO">
        select * from company;
    </select>

    <!--회사 기본정보 출력-->
    <select id="findById" resultType="com.dq.aquaranth.company.dto.CompanyDTO">
        select * from company where company_no = #{companyNo};
    </select>


    <insert id="insertOrga">
        insert into orga (upper_orga_no, orga_type) value (#{upperOrgaNo}, #{orgaType});
        <selectKey keyProperty="orgaNo" resultType="long" order="AFTER">
            select LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!--회사 기본정보 등록-->
    <insert id="insert">
        insert into company (
            company_no, company_name, company_address, company_tel,
            owner_name, founding_date, business_number, company_use,
            orga_no
        ) values (
            #{companyNo}, #{companyName}, #{companyAddress}, #{companyTel},
            #{ownerName}, #{foundingDate}, #{businessNumber}, #{companyUse},
            #{orgaNo}
        )
        <selectKey keyProperty="companyNo" resultType="long" order="AFTER">
            select LAST_INSERT_ID()
        </selectKey>
    </insert>

    <!--회사 기본정보 수정-->
    <update id="update">
        update company
            set company_name=#{companyName}, company_address=#{companyAddress}, company_tel=#{companyTel},
                owner_name=#{ownerName}, company_use=#{companyUse}
        where company_no = #{companyNo}
    </update>

    <!--회사 정보 삭제-->
    <delete id="deleteById">
        delete from company where company_no = #{companyNo}
    </delete>

    <!--회사코드, 회사명, 사용여부로 검색-->
    <select id="search" resultType="com.dq.aquaranth.company.dto.CompanyListDTO">
        select * from company
            where company_use=#{companyUse}
                and (company_no like concat('%', #{companySearch}, '%')
                or company_name like concat('%', #{companySearch}, '%'));
    </select>
</mapper>
